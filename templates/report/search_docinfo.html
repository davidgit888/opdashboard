{% load staticfiles %}
<script src="{% static 'js/jquery-3.3.1.js' %}"></script> 
<link href="{% static 'css/table.css' %}" rel="stylesheet">  
<script src="{% static 'js/jquery.tablesorter.js' %}"></script>
<script src="{% static 'js/table_freeze.js' %}"></script>
<script src="{% static 'js/jquery.floatThead.js' %}"></script>
<script>

    var all_results = '{{result|safe}}';
    var all_type_info = '{{doc_type_result|safe}}';
    var results = $.parseJSON(all_results);
    var type_info = $.parseJSON(all_type_info);
    var r_len = Object.keys(results["info"])['length'];
    var t_len = Object.keys(type_info['id'])['length'];
    var doc_list = '{{doc_id|safe}}';
    var jdoc_list = $.parseJSON(doc_list);

    function refresh(){
        location.reload();
    }
    
    window.onload = function(){
        // append data
        for(i=0;i<t_len;i++){
            $('#search_table thead tr').append( '<th>'  + type_info["type"][i] + '</th>' );
        }
        // create table
        for(i=0;i<jdoc_list.length;i++){
                var str_td=''
                str_td += '<td class="link"><u><strong><span style="color:blue">'  + jdoc_list[i] + '</span></strong></u></td>'
                for(k=0;k<r_len;k++){
                    {% comment %}                     
                    if(k==0){
                            $('#search_table tbody:last-child ').append( '<tr />').children('tr:last');
                            $('#search_table tbody:last-child ').append( '<td class="link"><u><strong><span style="color:blue">'  + jdoc_list[i] + '</span></strong></u></td>' );
                        }
                    
                  
                    for(j=0;j<t_len;j++){
                        
                        if(results['sfg'][k]==jdoc_list[i] && results['type_id'][k]==type_info['id'][j]){
                            $('#search_table tbody:last-child ').append( '<td>'  + results["info"][k] + '</td>' );   
                        }    
                    }
                    {% endcomment %}
                    
                    for(j=0;j<t_len;j++){
                        
                        if(results['sfg'][k]==jdoc_list[i] && results['type_id'][k]==type_info['id'][j]){
                            if(results["info"][k] == 'Y'){
                                str_td += '<td style="background:green">'  + results["info"][k] + '</td>';
                            }
                            else{
                                str_td += '<td>'  + results["info"][k] + '</td>';
                            }
                               
                        }
                    
                    }
                    //$('#search_table tbody:last-child').append( '<tr>'+str_td+'</tr>');
                    
                }
                $('#search_table tbody:last-child').append( '<tr>'+str_td+'</tr>');
        } 

        // create link
        $(".link").click(function(){
            var sfg_id=$(this)[0].textContent;
            
            url = '/report/update_docinfo/?sfg='+sfg_id
            newwindow=window.location.href=url;
            if (window.focus) {newwindow.focus()} 
        });

       
        
        
    }
      $(document).ready(function() {
            var $table = $('#search_table');
            $table.floatThead();
        });
    function redi_url(){
        window.location.replace('/report/search_docinfo/?sfg=');
    }
    $(function () {
        $("#filterName").keyup(function () {
        $("#search_table tbody tr").hide() //将tbody中的tr都隐藏
            .filter(":contains('"+($(this).val())+"')").show(); //，将符合条件的筛选出来
        });
     });
</script>

<div>
    <br/><br/>
    <h1>归档记录</h1><br/>
    <h4>归档记录查询</h4>
    
    
    
    <div>
        <input type='button' value='刷新' onclick='refresh()'>
        <input type='button' value='显示所有数据' onclick='redi_url()'>
        <span>筛选：</span><input type="text" id="filterName">
        <br/><br/>
        <table id='search_table' style='text-align:center;' border=1  >
            <thead>
                <tr>
                    <th>SFG</th>
                </tr>
               
                
            </thead>
            <tbody>
               
            </tbody>
        </table>
    </div>
    <br/><br/>
    <input type='button' value='刷新' onclick='refresh()'>
<div>