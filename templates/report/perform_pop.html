{% load staticfiles %}

<script src="{% static 'js/Calendar.js' %}"></script>
<script src="{% static 'js/jquery-1.9.1.js' %}"></script> 

<script src="{% static 'js/jquery.tablesorter.js' %}"></script>

<script>
    var p_save_status = '{{p_save_status}}'
    function save_all_perform(){
        if(p_save_status=='No'){
            var rows = document.getElementById("performance_table").rows;
            //alert(rows.length);
            //var row = rows[1];
            //alert(row);
            //var length = row.cells.length;
            //alert(length);
            for(j=1;j<rows.length;j++){

            
                    row = rows[j]
                
                    var user = row.cells[0].innerText;
                    var natural_time = row.cells[1].innerText;
                    var perfom = row.cells[2].innerText;
                    var standard = row.cells[3].innerText;
                    var real = row.cells[4].innerText;
                    var support = row.cells[5].innerText;
                    var borrow = row.cells[6].innerText;
                    var kpi = row.cells[7].innerText;
                    var efficiency = row.cells[8].innerText;
                    var date = row.cells[9].innerText;
                    var username = row.cells[10].innerText;
                    var group = row.cells[11].innerText;
                    $.get("/report/save_indiv_perform/",{'user':user,'natural_time':natural_time,'perfom':perfom,'standard':standard,
                    'real':real,'support':support,'borrow':borrow,'kpi':kpi,'efficiency':efficiency,'date':date,'username':username,
                    'group':group}, function(ret){
                        if(ret.includes('失败')){
                            alert(ret);
                        }
                        
                        
                    //var result = ret;
                    //validateQty(ret);
                })
                document.getElementById("p_save_message").innerHTML="保存成功";
                
            }
        }else{
            alert('当天记录已经保存，请勿重复保存！')
        }
        
        
        
    }

    function back(){
        window.history.back(-1);
    }
    window.onload = function (){
        $("#performance_table tbody tr").click(function(){
                
                var date = $(this).find('td').eq(9).html();
                var username = $(this).find('td').eq(10).html();
                var user = $(this).find('td').eq(0).html();
                {% comment %} //alert($(this).html());
                
                //$(this).attr('class', 'submit');
                var b = this.index;
                alert(date);
                alert(username);
                //alert(a);
             {% endcomment %}
            url = '/report/per_get_prod_log/?date='+date+'&username='+username+'&user='+user+'&tab=dKpi'
            newwindow=window.location.href=url;
            if (window.focus) {newwindow.focus()}
           //if(newwindow){data.submit();}
            
            //var b = $("#b").val();
            {% comment %} $.get("/report/per_get_prod_log/",{'date':date,'username':username}, function(ret){
                for(i=0;i<ret.length;i++){
                    alert(ret.length);
                    alert(ret[i].sfg);
                    alert(ret[i].type);
                    alert(ret[i].op);
                    alert(ret[i].qty);
                    alert(ret[i].standard);
                    alert(ret[i].real);
                   
                    
                }
                
                //var result = ret;
                //validateQty(ret);
            }) {% endcomment %}

        });

         $("#p_submit").click(function(){
        
        var date = $('#p_perform_today').val();
        //alert(date);
        url = '/report/perform_pop/?date='+date
        newwindow=window.open(url,'windowName','height=800,width=1500,top=100, left=200');
        if (window.focus) {newwindow.focus()}
    });   

    }
</script>
<div>
    <div style='position:relative;left:30%;'>
        <fieldset style = 'width:500px' style='position:relative;left:30%;'>
            <legend>查询</legend>
            
                    <p>Date: <input id='p_perform_today' name='p_perform_today' type="text" onclick="fPopCalendar(event,this,this)" value = '' readonly="readonly" > 
                    <input type='hidden' value='dKpi'>
                   
                    <input id='p_submit' type='submit' value='Submit'></p>

        </fieldset>
    </div>
    <div>   
        <p id='p_save_message'></p>
        
        <input type='button' value='提交数据' onclick='save_all_perform()'>
                
    </div>
    <div height='80%'>
                <div id="perform_dialog" title="Basic modal dialog" style="display:none">
                    <p></p>
                </div>
                <div style="overflow:scroll " >
                    <table id='performance_table' border=1  style="overflow:scroll;text-align:center; ">
                        <thead>
                            <tr class = 'parent'>
                                <th class= 'tableHead' width=200>员工</th>
                                <th class= 'tableHead' width=100>工作时间</th>
                                <th class= 'tableHead' width=100>个人绩效</th>
                                <th class= 'tableHead' width=100>标准工时</th>
                                <th class= 'tableHead' width=100>制造工时</th>
                                <th class= 'tableHead' width=100>辅助工时</th>
                                <th class= 'tableHead' width=100>外借工时</th>
                                <th class= 'tableHead' width=100>工效比</th>
                                <th class= 'tableHead' width=100>工时有效率</th>
                                
                                <th class= 'tableHead' width=100 >Date</th>
                                <th width=100>username</th>
                                <th width=100>组</th>
                                <th width=100>Validate</th>
                                {% comment %} <th style="visibility:hidden" >Validate</th>
                                <th style="visibility:hidden" >Validate</th> {% endcomment %}
                                
                                

                            </tr>                    
                        </thead>
                        <tbody>
                        
                                {% for  i in p_perform_list  %}
                                    <tr  class="{% cycle 'row1' 'row2' %}">
                                        <td width=200>{{i.p_user}}</td>
                                        {% if i.p_natural > 8 %}
                                            <td style='background:#3498DB' width=100>{{i.p_natural}}</td>
                                        
                                        {% elif i.p_natural < 8  %}
                                            <td style='background:#FF5733' width=100>{{i.p_natural}}</td>
                                        {% else %}
                                            <td style='background:lime' width=100>{{i.p_natural}}</td>
                                        {% endif %}
                                        
                                        <td width=100>{{i.p_total}}</td>
                                        <td width=100>{{i.p_standard}}</td>
                                        <td width=100>{{i.p_real}}</td>
                                        <td width=100>{{i.p_sup_without_borrow}}</td>
                                        <td width=100>{{i.p_sup_borrow}}</td>
                                        <td width=100>{{i.p_kpi}}</td>
                                        <td width=100>{{i.p_efficiency}}</td>
                                        <td width=100>{{p_date}}</td>
                                        <td width=100>{{i.username}}</td>
                                        <td width=100>{{i.group}}</td>
                                        {% if i.validate == '未保存' %}
                                            <td width=100 style='background:red'>{{i.validate}}</td>
                                        {% else %}
                                            <td width=100 style='background:lime'>{{i.validate}}</td>
                                        {% endif %}
                                        
                                        {% comment %} <td style="visibility:hidden"><div>{{i.p_produce_log}}</div></td>
                                        <td style="visibility:hidden"><div>{{i.p_sup_log}}</div></td> {% endcomment %}
                                    </tr>  
                                {% endfor %}        
                                            
                                        
                                
                            
                            
                        </tbody>
                    </table>
                   
                </div>

</div>
