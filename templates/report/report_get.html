<html>
<head>
{% load staticfiles %}
<script src="{% static 'js/jquery-1.9.1.js' %}"></script>   
<script>


    function valid_report(){
        var sfg_id = document.getElementById('sfg_id').value;
        var real_time = document.getElementById('real_time').value;
        if (isNaN(sfg_id) || sfg_id== ''){
            alert("SFG 必须是数字且不为空");
            return false;
        }else if (isNaN(real_time) || real_time == ''){
            alert("制造工时必须是数字且不为空");
            return false;
        }else{
            document.forms[0].action = '/report/get_data/';
        }
        
    }

    function valid_support(){
        var supportive_time = document.getElementById('supportive_time').value;
        var borrow_time = document.getElementById('borrow_time').value;
        if (isNaN(supportive_time) || supportive_time == ''){
            alert("辅助工时必须是数字且不为空");
            return false;
        }else if (isNaN(borrow_time) || borrow_time == ''){
            alert("外借必须是数字且不为空");
            return false;
        }else{
            document.forms[1].action ='/report/supportive_time/';
        }

    }
    $(document).ready(function(){
        $("#sfg_id").change(function(){
        //$(" rel="nofollow"#sum").click(function(){
            var a = $("#sfg_id").val();
            //var b = $("#b").val();
            $.get("/report/get_sfg/",{'a':a}, function(ret){
                $('#prod_type').val(ret.result)
            })
        //});
        }); 
         });

    $(document).ready(function(){
        //$("#op_id").change(function(){
        $("#qty").change(function(){
        //$(" rel="nofollow"#sum").click(function(){
            var a = $("#prod_type").val();
            var b = $('#op_id option:selected').val()
            var c = $('#prob_info option:selected').val()
            var d = $('#qty').val()
            //var b = $("#b").val();
            $.get("/report/get_standard_time/",{'type':a,'op':b,'prob':c,'qty':d}, function(ret){
                $('#standard_time').val(ret.result)
            })
        //});
        }); 
    });

    


</script>
<style type="text/css">
    .div1{float:left;width:45%;height50%;}


</style>
</head>
<body>
<div class='div1'>
    <h2>您好 {{user.last_name}}{{user.first_name}}</h2><br/><br/>


    <form onsubmit='valid_report()' action="/report/" method="post" >
        {% csrf_token %}
        
        {% if save_message %}
        <p>{{save_message}}</p>
        <br/>
        {% endif %}
        <label>SFG</lable>
        <input id='sfg_id' type='text' name='sfg_id' >
        <br/><br/>
        <label>机型</lable>
        <input id='prod_type' type='text' name='type' value='' readonly ><br/><br/>
        {% if groups %}
                <label>测头</lable>
                <select id='prob_info' name='prob_info' >
                <option value=' '>---</option>
                {% for entry in prob_list %}
                    <option value="{{ entry.prob_info  }}">{{ entry.prob_info }}</option>
                {% endfor %}
                </select>
                <br/><br/>
            {% else %}
                <select id = 'prob_info' name='prob_info' style='display:none'>
                    <option value=' '></option>
                </select>
            <br/><br/>
            {% endif %}

        <label>工步</lable>
            <select id='op_id' name="op_id">
                <option value=' '>---</option>
                {% for entry in op_list  %}
                    <option value = "{{entry.op_id}}">{{entry.op_id}}</option>
                {% endfor %}
            </select>
        <br/><br/>

        <label>数量</lable>
        <input id='qty' type='text' name='qty'>
        <br/><br/>

        <input type='text' name='user_name' value='{{user.last_name}}{{user.first_name}}' readonly style='display:none'>
    
        <label>标准工时</lable>
        <input id='standard_time' type='text' name='standard_time' value='' readonly>
        <br/><br/>
        <label>制造工时</lable>
        <input id = 'real_time' type='text' name='real_time'>
        <br/><br/>
        <input type="submit" value="提交">
        <br/><br/><br/><br/>
    </form>
</div>
<div class='div1'>
    <h3>当天报工记录查询</h3>

    <table border="1">
        <tr>
            <th>SFG</th>
            <th>机型</th>
            <th>工步</th>
            <th>测针（如果有）</th>
            <th>数量</th>
            <th>标准工时</th>
            <th>制造工时</th>
            <th>日期</th>
        </tr>
            {% for i in logs %}
            <tr>
                <td>{{i.sfg}} </td>
                <td>{{i.type}} </td>
                <td>{{i.op}} </td>
                <td>{{i.prob}} </td>
                <td>{{i.qty}} </td>
                <td>{{i.standard }}</td>
                <td>{{i.real}} </td>
                <td>{{i.date}}</td>
            </tr>
            {% endfor %}
    </table>
    <br/>
    <p>当天KPI (KIP算法：标准工时/制造工时)</p>
    <p>{{today_kpi}}</p>
    <p>{{stand_time_today}}</P>
</div>


<div style="width:100%">
<br/><br/><br/><br/><br/><br/><br/><br/>
<HR style="FILTER: alpha(opacity=100,finishopacity=0,style=3)" width="100%" color='blue' SIZE=3>
<br/><br/><br/>
</div>
<div>
<form action='/report/' method='post' onsubmit='valid_support()'>
    {% csrf_token %}
    
    <h2>其他信息</h2>
    <br/>
    {{support}}{{borrow}}
    <br/>

    <label>辅助工时</lable>
    <input id='supportive_time' name='supportive_time'>
    
    </lable>外借工时</lable>
    <input id='borrow_time' name='borrow_time'>
    <br/><br/><br/>
    
    <input type='submit' value='提交'>
</form>
</div>
</body>
</html>